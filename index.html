<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ My Ratings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css"> 
    <style>
        /* Temporarily adding the margin fix here for the star for immediate visual check */
        .rating-badge::before {
            content: '‚≠ê '; 
            margin-right: 5px; /* Ensures space between star and rating text */
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand fs-4" href="index.html">
    <img src="logo.png" alt="Rating Hub Logo" style="height: 35px; margin-right: 8px;">
    Rating Hub
</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Movies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="anime.html">Anime</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="series.html">Series</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="main-content container">
        <header class="text-center mb-5">
            <h1 class="display-4 text-warning">My Personal Movie Scoreboard</h1>
            <p class="lead text-secondary">Rating the best and worst of cinema.</p>
        </header>

        <div class="row mb-5 justify-content-center">
            <div class="col-lg-10 d-flex">
                <input type="text" id="movie-search" class="form-control form-control-lg bg-secondary text-white border-0 me-3" placeholder="Search for a movie title..." onkeyup="applyFilters()">
                
                <select id="year-filter" class="form-select bg-secondary text-white border-0 me-3" style="width: 200px;" onchange="applyFilters()">
                    <option value="All">Filter Year</option>
                    </select>
            </div>
        </div>
        
        <div id="no-results-alert" class="alert text-center custom-alert" role="alert" style="display: none;">
            <span style="font-size: 1.5rem; line-height: 1;">‚ùå</span>
            <strong class="text-dark">Oops! Movie not found in your ratings list.</strong>
        </div>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="content-list">
            </div>
    </div>
    
    <footer class="footer">
        <div class="container">
            &copy; 2025 Rating Hub | Created with <span class="text-danger">‚ù§</span> and Bootstrap
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        let movieData = []; // Global variable to store fetched data
        const contentList = document.getElementById('content-list');
        const noResultsAlert = document.getElementById('no-results-alert');
        const yearFilter = document.getElementById('year-filter');
        
        // --- 1. FUNCTION TO FETCH DATA ---
        async function fetchMovieData() {
            try {
                // Fetch the data from the local JSON file
                const response = await fetch('json_files/movies_data.json'); 
                if (!response.ok) {
                    throw new Error('Failed to load movies_data.json');
                }
                movieData = await response.json();
                
                // Populate filter and render on load
                populateYearFilter();
                renderContent(true); // Render and sort high-to-low by default
            } catch (error) {
                console.error("Error fetching data:", error);
                
                // Use the visually consistent card/movie-card style for the error.
                contentList.innerHTML = `
                    <div class="col-12">
                        <div class="card movie-card p-4 text-center">
                            <h4 class="text-warning mb-2">
                                üö® Could not load movie list.
                            </h4>
                            <p class="text-secondary mb-0">Please check the JSON file path: <strong>movies_data.json</strong></p>
                        </div>
                    </div>
                `;
            }
        }

        // NEW: Function to populate the year dropdown dynamically
        function populateYearFilter() {
            // Get unique years and sort newest to oldest
            const years = [...new Set(movieData.map(movie => movie.year.toString()))]
                          .sort((a, b) => b - a);
            
            // Clear existing options (just 'All') and add dynamic years
            yearFilter.innerHTML = '<option value="All">Filter Year (All)</option>';

            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }
        
        // --- 2. FUNCTION TO RENDER/SORT DATA ---
        function renderContent(shouldSort = false) {
            let dataToRender = [...movieData]; 

            if (shouldSort) {
                // Sort by rating (DESC) and then by year (DESC)
                dataToRender.sort((a, b) => {
                    if (b.rating !== a.rating) {
                        return b.rating - a.rating; 
                    }
                    return b.year - a.year;
                });
            }

            contentList.innerHTML = '';

            dataToRender.forEach(movie => {
                // Highlight recent years (2024+) with a warning button
                const yearClass = 'btn-warning';
                
                const blockHTML = `
                    <div class="col content-block" data-year="${movie.year}">
                        <div class="card movie-card h-100">
                            <div class="movie-poster-container">
                                <img src="${movie.image_src}" class="card-img-top" alt="Movie Poster: ${movie.title}">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title text-warning">${movie.title}</h5>
                                <p class="card-text text-secondary mb-3">${movie.description}</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <span class="rating-badge" data-rating="${movie.rating.toFixed(1)}">${movie.rating.toFixed(1)} / 10</span>
                                    
                                    <button class="btn ${yearClass} status-indicator">
                                        üìÖ ${movie.year}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                contentList.insertAdjacentHTML('beforeend', blockHTML);
            });
            
            // Re-run filter to ensure year filter is applied
            applyFilters();
        }

        // --- 3. COMBINED FILTERING FUNCTION (Modified for Year Filter) ---
        function applyFilters() {
            const searchInput = document.getElementById('movie-search').value.toLowerCase().trim();
            const yearFilterValue = yearFilter.value;
            const contentBlocks = document.querySelectorAll('.content-block');
            let foundCount = 0;

            contentBlocks.forEach(block => {
                const title = block.querySelector('.card-title').textContent.toLowerCase();
                const movieYear = block.getAttribute('data-year');
                
                // 1. Check Search Filter
                const searchMatch = title.includes(searchInput);

                // 2. Check Year Filter
                const yearMatch = (yearFilterValue === 'All' || movieYear === yearFilterValue);

                // 3. Apply Visibility
                if (searchMatch && yearMatch) {
                    block.style.display = 'block';
                    foundCount++;
                } else {
                    block.style.display = 'none';
                }
            });

            // Show or hide the no-results message
            if (foundCount === 0 && (searchInput.length > 0 || yearFilterValue !== 'All')) {
                noResultsAlert.style.display = 'flex';
            } else {
                noResultsAlert.style.display = 'none';
            }
        }

        // --- 4. INITIALIZE ---
        document.addEventListener('DOMContentLoaded', fetchMovieData);
    </script>
</body>
</html>